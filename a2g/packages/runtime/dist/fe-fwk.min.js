function e(e){return e.filter((e=>null!=e))}const t={TEXT:"text",ELEMENT:"element",FRAGMENT:"fragment"};function n(n,s={},c=[]){return{tag:n,props:s,children:r(e(c)),type:t.ELEMENT}}function s(e){return{type:t.TEXT,value:e}}function r(e){return e.map((e=>"string"==typeof e?s(e):e))}function c(n){return{type:t.FRAGMENT,children:r(e(n))}}function o(e){const{type:n}=e;switch(n){case t.TEXT:!function(e){const{el:t}=e;t.remove()}(e);break;case t.ELEMENT:!function(e){const{el:t,children:n,listeners:s}=e;t.remove(),n.forEach(o),s&&(!function(e={},t){Object.entries(e).forEach((([e,n])=>{t.removeEventListener(e,n)}))}(s,t),delete e.listeners)}(e);break;case t.FRAGMENT:!function(e){const{children:t}=e;t.forEach(o)}(e);break;default:throw new Error(`Can't destroy DOM of type: ${n}`)}delete e.el}function a(e,t){const{class:n,style:s,...r}=t;n&&function(e,t){e.className="","string"==typeof t&&(e.className=t);Array.isArray(t)&&e.classList.add(...t)}(e,n),s&&Object.entries(s).forEach((([t,n])=>{!function(e,t,n){e.style[t]=n}(e,t,n)}));for(const[t,n]of Object.entries(r))i(e,t,n)}function i(e,t,n){null==n?function(e,t){e[t]=null,e.removeAttribute(t)}(e,t):t.startsWith("data-")?e.setAttribute(t,n):e[t]=n}function u(e,n){switch(e.type){case t.TEXT:!function(e,t){const{value:n}=e,s=document.createTextNode(n);e.el=s,t.append(s)}(e,n);break;case t.ELEMENT:!function(e,t){const{tag:n,props:s,children:r}=e,c=document.createElement(n);(function(e,t,n){const{on:s,...r}=t;n.listeners=function(e={},t){const n={};return Object.entries(e).forEach((([e,s])=>{console.log(e,s);const r=function(e,t,n){return n.addEventListener(e,t),t}(e,s,t);n[e]=r})),n}(s,e),a(e,r)})(c,s,e),e.el=c,r.forEach((e=>u(e,c))),t.append(c)}(e,n);break;case t.FRAGMENT:!function(e,t){const{children:n}=e;e.el=t,n.forEach((e=>u(e,t)))}(e,n);break;default:throw new Error(`Can't mount DOM of type: ${e.type}`)}}class l{#e=new Map;#t=[];subscribe(e,t){this.#e.has(e)||this.#e.set(e,[]);const n=this.#e.get(e);return n.includes(t)?()=>{}:(n.push(t),()=>{const e=n.indexOf(t);n.splice(e,1)})}afterEveryCommand(e){return this.#t.push(e),()=>{const t=this.#t.indexOf(e);this.#t.splice(t,1)}}dispatch(e,t){this.#e.has(e)?this.#e.get(e).forEach((e=>e(t))):console.warn(`No handlers for command: ${e}`),this.#t.forEach((e=>e()))}}function f({state:e,view:t,reducers:n={}}){let s=null,r=null;const c=new l,a=[c.afterEveryCommand(f)];function i(e,t){c.dispatch(e,t)}for(const t in n){const s=n[t],r=c.subscribe(t,(t=>{e=s(e,t)}));a.push(r)}function f(){r&&o(r),r=t(e,i),console.log(r),u(r,s)}return{mount(e){s=e,f()},unmount(){o(r),r=null,a.forEach((e=>e()))}}}export{t as DOM_TYPES,f as createApp,n as h,c as hFragment,s as hString};
