function e(e,t,n){return n.addEventListener(e,t),t}const t={ADD:"add",REMOVE:"remove",MOVE:"move",NOOP:"noop"};function n(e){return e.filter((e=>null!=e))}class r{#e=[];#t=[];#n;constructor(e,t){this.#e=[...e],this.#t=e.map(((e,t)=>t)),this.#n=t}get length(){return this.#e.length}isRemoval(e,t){if(e>=this.length)return!1;const n=this.#e[e];return-1===t.findIndex((e=>this.#n(n,e)))}removeItem(e){const n={op:t.REMOVE,index:e,item:this.#e[e]};return this.#e.splice(e,1),this.#t.splice(e,1),n}isNoop(e,t){if(e>=this.length)return!1;const n=this.#e[e],r=t[e];return this.#n(n,r)}originalIndexAt(e){return this.#t[e]}noopItem(e){return{op:t.NOOP,originalIndex:this.originalIndexAt(e),index:e,item:this.#e[e]}}isAddition(e,t){return-1===this.findIndexFrom(e,t)}findIndexFrom(e,t){for(let n=t;n<this.length;n++)if(this.#n(e,this.#e[n]))return n;return-1}addItem(e,n){const r={op:t.ADD,index:n,item:e};return this.#e.splice(n,0,e),this.#t.splice(n,0,-1),r}moveItem(e,n){const r=this.findIndexFrom(e,n),s={op:t.MOVE,originalIndex:this.originalIndexAt(r),from:r,index:n,item:this.#e[r]},[o]=this.#e.splice(r,1);this.#e.splice(n,0,o);const[i]=this.#t.splice(r,1);return this.#t.splice(n,0,i),s}removeItemsAfter(e){const t=[];for(;this.length>e;)t.push(this.removeItem(e));return t}}const s={TEXT:"text",ELEMENT:"element",FRAGMENT:"fragment"};function o(e,t={},r=[]){return{tag:e,props:t,children:c(n(r)),type:s.ELEMENT}}function i(e){return{type:s.TEXT,value:e}}function c(e){return e.map((e=>"string"==typeof e?i(e):e))}function a(e){return{type:s.FRAGMENT,children:c(n(e))}}function u(e){if(null==e.children)return[];const t=[];for(const n of e.children)n.type===s.FRAGMENT?t.push(...u(n)):t.push(n);return t}function l(e){const{type:t}=e;switch(t){case s.TEXT:!function(e){const{el:t}=e;t.remove()}(e);break;case s.ELEMENT:!function(e){const{el:t,children:n,listeners:r}=e;t.remove(),n.forEach(l),r&&(!function(e={},t){Object.entries(e).forEach((([e,n])=>{t.removeEventListener(e,n)}))}(r,t),delete e.listeners)}(e);break;case s.FRAGMENT:!function(e){const{children:t}=e;t.forEach(l)}(e);break;default:throw new Error(`Can't destroy DOM of type: ${t}`)}delete e.el}function f(e,t){const{class:n,style:r,...s}=t;n&&function(e,t){e.className="","string"==typeof t&&(e.className=t);Array.isArray(t)&&e.classList.add(...t)}(e,n),r&&Object.entries(r).forEach((([t,n])=>{d(e,t,n)}));for(const[t,n]of Object.entries(s))p(e,t,n)}function d(e,t,n){e.style[t]=n}function h(e,t){e.style[t]=null}function p(e,t,n){null==n?m(e,t):t.startsWith("data-")?e.setAttribute(t,n):e[t]=n}function m(e,t){e[t]=null,e.removeAttribute(t)}function E(t,n,r){switch(t.type){case s.TEXT:!function(e,t,n){const{value:r}=e,s=document.createTextNode(r);e.el=s,y(s,t,n)}(t,n,r);break;case s.ELEMENT:!function(t,n,r){const{tag:s,props:o,children:i}=t,c=document.createElement(s);(function(t,n,r){const{on:s,...o}=n;r.listeners=function(t={},n){const r={};return Object.entries(t).forEach((([t,s])=>{console.log(t,s);const o=e(t,s,n);r[t]=o})),r}(s,t),f(t,o)})(c,o,t),t.el=c,i.forEach((e=>E(e,c))),y(c,n,r)}(t,n,r);break;case s.FRAGMENT:!function(e,t,n){const{children:r}=e;e.el=t,r.forEach(((e,r)=>E(e,t,n?n+r:null)))}(t,n,r);break;default:throw new Error(`Can't mount DOM of type: ${t.type}`)}}function y(e,t,n){if(null==n)return void t.append(e);if(n<0)throw new Error(`Index must be a positive integer, got ${n}`);const r=t.childNodes;n>=r.length?t.append(e):t.insertBefore(e,r[n])}class g{#r=new Map;#s=[];subscribe(e,t){this.#r.has(e)||this.#r.set(e,[]);const n=this.#r.get(e);return n.includes(t)?()=>{}:(n.push(t),()=>{const e=n.indexOf(t);n.splice(e,1)})}afterEveryCommand(e){return this.#s.push(e),()=>{const t=this.#s.indexOf(e);this.#s.splice(t,1)}}dispatch(e,t){this.#r.has(e)?this.#r.get(e).forEach((e=>e(t))):console.warn(`No handlers for command: ${e}`),this.#s.forEach((e=>e()))}}function v(e,t){if(e.type!==t.type)return!1;if(e.type===s.ELEMENT){const{tag:n}=e,{tag:r}=t;return n===r}return!0}function I(e,t){const n=Object.keys(e),r=Object.keys(t);return{added:r.filter((t=>!(t in e))),removed:n.filter((e=>!(e in t))),updated:r.filter((n=>n in e&&e[n]!==t[n]))}}function b(e){return function(e){return""!==e}(e.trim())}function N(n,o,i){if(!v(n,o)){const e=function(e,t){const n=Array.from(e.childNodes).indexOf(t);if(n<0)return null;return n}(i,n.el);return l(n),E(o,i,e),o}switch(o.el=n.el,o.type){case s.TEXT:return function(e,t){const n=e.el,{value:r}=e,{value:s}=t;r!==s&&(n.nodeValue=s)}(n,o),o;case s.ELEMENT:!function(t,n){const r=t.el,{class:s,style:o,on:i,...c}=t.props,{class:a,style:u,on:l,...f}=n.props,{listeners:E}=t;(function(e,t,n){const{added:r,removed:s,updated:o}=I(t,n);for(const t of s)m(e,t);for(const t of r.concat(o))p(e,t,n[t])})(r,c,f),function(e,t,n){const r=O(t),s=O(n),{added:o,removed:i}=(c=r,a=s,{added:a.filter((e=>!c.includes(e))),removed:c.filter((e=>!a.includes(e)))});var c,a;i.length>0&&e.classList.remove(...i);o.length>0&&e.classList.add(...o)}(r,s,a),function(e,t={},n={}){const{added:r,removed:s,updated:o}=I(t,n);for(const t of s)h(e,t);for(const t of r.concat(o))d(e,t,n[t])}(r,o,u),n.listeners=function(t,n={},r={},s={}){const{removed:o,added:i,updated:c}=I(r,s);for(const e of o.concat(c))t.removeEventListener(e,n[e]);const a={};for(const n of i.concat(c)){const r=e(n,s[n],t);a[n]=r}return a}(r,E,i,l)}(n,o)}return function(e,n){const s=u(e),o=u(n),i=e.el,c=function(e,t,n=((e,t)=>e===t)){const s=[],o=new r(e,n);for(let e=0;e<t.length;e++){if(o.isRemoval(e,t)){s.push(o.removeItem(e));continue}if(o.isNoop(e,t)){s.push(o.noopItem(e));continue}const n=t[e];o.isAddition(n,e)?s.push(o.addItem(n,e)):s.push(o.moveItem(n,e))}return s.push(...o.removeItemsAfter(t.length)),s}(s,o,v);for(const e of c){const{originalIndex:n,index:r,item:c}=e;switch(e.op){case t.ADD:E(c,i,r);break;case t.REMOVE:l(c);break;case t.MOVE:{const e=s[n],t=o[r],c=e.el,a=i.childNodes[r];i.insertBefore(c,a),N(e,t,i);break}case t.NOOP:N(s[n],o[r],i)}}}(n,o),o}function O(e=""){return Array.isArray(e)?e.filter(b):e.split(/(\s+)/).filter(b)}function T({state:e,view:t,reducers:n={}}){let r=null,s=null,o=!1;const i=new g,c=[i.afterEveryCommand((function(){s&&l(s);const n=t(e,a);E(s,r),s=N(s,n,r)}))];function a(e,t){i.dispatch(e,t)}for(const t in n){const r=n[t],s=i.subscribe(t,(t=>{e=r(e,t)}));c.push(s)}return{mount(n){if(o)throw new Error("The application is already mounted");r=n,s=t(e,a),E(s,r),o=!0},unmount(){l(s),s=null,c.forEach((e=>e())),o=!1}}}export{s as DOM_TYPES,T as createApp,o as h,a as hFragment,i as hString};
